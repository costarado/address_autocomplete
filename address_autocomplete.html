<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>Zoho Address Autocomplete</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSbIWCrk9JY4XLN5SDtxNuVwlU4Cb7Vv4&language=he&region=IL&libraries=places"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin: 5px 10px;
    }
    #autocomplete {
      width: 50%;
      font-size: 15px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      height: 35px;
    }
    #map {
      width: 45%;
      height: 220px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <input id="autocomplete" placeholder="הקלד כתובת בעברית או באנגלית..." />
  <div id="map"></div>
  <script>
    let map, marker;
    const input = document.getElementById("autocomplete");
    const autocomplete = new google.maps.places.Autocomplete(input, {
      types: ['address'],
      componentRestrictions: { country: 'IL' }
    });

    const initMap = (lat = 31.7683, lng = 35.2137) => {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat, lng },
        zoom: 13
      });
      marker = new google.maps.Marker({ map, position: { lat, lng } });
    };

    autocomplete.addListener("place_changed", () => {
      const place = autocomplete.getPlace();
      if (!place.geometry) return;
      const loc = place.geometry.location;
      map.setCenter(loc);
      marker.setPosition(loc);

      const result = {};
      if (place.address_components) {
        place.address_components.forEach(c => {
          if (c.types.includes("locality")) result.city = c.long_name;
          if (c.types.includes("postal_code")) result.zip = c.long_name;
          if (c.types.includes("route")) result.street = c.long_name;
        });
      }
      parent.postMessage(result, "*");
    });

    window.onload = () => initMap();
  </script>
</body>
</html>
